<div class="page-container">
  <div class="form-wrapper">
    <header class="form-header">
      <button mat-icon-button (click)="onCancel()" aria-label="Go back">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>New Candidate</h1>
    </header>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="card candidate-form">
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter name" />
          @if (form.get('name')?.hasError('required') && form.get('name')?.touched) {
            <mat-error>Name is required</mat-error>
          }
          @if (form.get('name')?.hasError('maxlength')) {
            <mat-error>Maximum 100 characters</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Surname</mat-label>
          <input matInput formControlName="surname" placeholder="Enter surname" />
          @if (form.get('surname')?.hasError('required') && form.get('surname')?.touched) {
            <mat-error>Surname is required</mat-error>
          }
          @if (form.get('surname')?.hasError('maxlength')) {
            <mat-error>Maximum 100 characters</mat-error>
          }
        </mat-form-field>
      </div>

      <div class="file-upload-section">
        <label class="file-upload-label">Excel File</label>
        <div
          class="file-upload-area"
          [class.has-file]="selectedFile"
          [class.drag-over]="isDragOver"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave()"
          (drop)="onDrop($event)"
        >
          @if (selectedFile) {
            <mat-icon>description</mat-icon>
            <span class="file-name">{{ selectedFile.name }}</span>
            <button mat-icon-button type="button" (click)="onClearFile($event)" aria-label="Remove file">
              <mat-icon>close</mat-icon>
            </button>
          } @else {
            <mat-icon>cloud_upload</mat-icon>
            <p>Drag the Excel file here or</p>
            <button mat-stroked-button type="button" (click)="fileInput.click()">
              Select file
            </button>
          }
          <input
            #fileInput
            type="file"
            accept=".xlsx,.xls"
            (change)="onFileSelected($event)"
            hidden
          />
        </div>
        @if (fileError) {
          <mat-error class="file-error">{{ fileError }}</mat-error>
        }
        <p class="file-hint">
          The file must contain one row with: Seniority (junior/senior), Years of Experience, Availability
        </p>
      </div>

      <div class="form-actions">
        <button mat-button type="button" (click)="onCancel()">Cancel</button>
        <button
          mat-flat-button
          color="primary"
          type="submit"
          [disabled]="form.invalid || !selectedFile || submitting"
        >
          @if (submitting) {
            <mat-spinner diameter="20"></mat-spinner>
          } @else {
            Submit
          }
        </button>
      </div>
    </form>
  </div>
</div>
